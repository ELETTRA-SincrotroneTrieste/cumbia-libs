<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>qumbia-tango-controls: Frequently Asked Questions (Tango)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">qumbia-tango-controls
   &#160;<span id="projectnumber">1.x</span>
   </div>
   <div id="projectbrief">Library on top of cumbia-qtcontrols and cumbia-tango</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Frequently Asked Questions (Tango) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h3>Table of contents</h3>
<ul>
<li><a href="#newproj">Is there a way to quickly set up a new cumbia project?</a></li>
<li><a href="#migrate">Is there a way to migrate a QTango project into a cumbia one?</a></li>
<li><a href="#cudata">What is the default structure used to exchange data by cumbia library? How do I use it?</a></li>
<li><a href="#readatt">What is the quickest way to read a Tango attribute in a cumbia application</a></li>
<li><a href="#state">What's the quickest procedure to display a Tango <em>state</em> and possibly get the associated color?</a></li>
<li><a href="#cudata_keys">How did you know that the <em>res</em> CuData contained those very keys such as "value", "state_color", "timestamp_ms", and so on.. ?</a></li>
<li><a href="#commands">A quick way to perform a command inout on a device</a></li>
<li><a href="#cumbiawidget">In QTango there used to be a widget ready to read and display a value. In cumbia there is not. How do I quickly adapt an existing Qt widget?</a></li>
<li><a href="#configure">I either used QuWatcher or implemented CuDataListener on my custom graphical object. How do I configure it through the Tango database properties (setting maximum and minimum values, display unit and data format)?</a></li>
<li><a href="#tangoprops">How do I get a Tango device property?</a></li>
<li><a href="#except">How to format a message from a Tango <em>Exception</em>?</a></li>
<li><a href="#migrate_log">How to migrate from QTango <em>TUtil::instance()-&gt;addLog()</em> to cumbia log dialog?</a></li>
<li><a href="#ui_h_errors">After converting a QTango project to a cumbia project, I get errors on the ui/ui_filexxx.h concerning properties of widgets that I know are defined in the cumbia widget version as well, e.g. <em>tLabel-&gt;setFalseString(..)</em></a></li>
<li><a href="#migrate_config_state_color">How to migrate QTango <em>Config::instance()-&gt;setStateColor</em> (and setStateString) to cumbia?</a></li>
<li><a href="#multiengine">How to support multiple engines (e.g. Tango and Epics) in the same application</a> |VALUES");
        std::vector&lt;std::string&gt; plist = data["list"].toStringVector(); for(size_t i = 0; i &lt; plist.size(); i++) printf("%s--&gt;%s\n", plist[i].c_str(), data[plist[i]].toString().c_str()); } </li>
</ul>
<h4>2. The <em>activity</em> approach (in secondary thread)</h4>
<ul>
<li>Define a class inheriting from CuDataListener and implement the onUpdate(const CuData&amp;) virtual method where results will be delivered. The construction of the input data list is the same as in the example (1). The extraction of the results is identical too.</li>
</ul>
<p>#### The header file </p><div class="fragment"><div class="line"><span class="keyword">class </span>PropertyReader : <span class="keyword">public</span> CuDataListener</div><div class="line">{</div><div class="line">     <span class="comment">// ...</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// CuDataListener interface</span></div><div class="line">    <span class="keywordtype">void</span> onUpdate(<span class="keyword">const</span> CuData &amp;data);</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    CumbiaTango* m_ct;</div></div><!-- fragment --><h4>The implementation file</h4>
<p>We use the CuTDbPropertyReader class to fetch the properties and receive the data when ready.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> PropertyReader::get(...) {</div><div class="line">    <span class="comment">// CuTDbPropertyReader needs a const char* as id as first parameter and a</span></div><div class="line">    <span class="comment">// pointer to CumbiaTango as second parameter</span></div><div class="line">    CuTDbPropertyReader *pr = <span class="keyword">new</span> CuTDbPropertyReader(<span class="stringliteral">&quot;myPropertyReader&quot;</span>, m_ct);</div><div class="line">    pr-&gt;addListener(<span class="keyword">this</span>);  <span class="comment">// we implement CuDataListener</span></div><div class="line">    pr-&gt;get(in_data);       <span class="comment">// request properties</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> PropertyReader::onUpdate(<span class="keyword">const</span> CuData &amp;data)</div><div class="line">{</div><div class="line">    <span class="comment">// see the point (3) of the *quick way* example above to extract  and print results</span></div><div class="line">}</div></div><!-- fragment --><h4>Example code</h4>
<p>You can find a working command line example under</p>
<ul>
<li><em>cumbia-libs/cumbia-tango/examples/dbproperties</em></li>
</ul>
<h2>Q.</h2>
<p><a class="anchor" id="except"></a> </p><h3>How to format a message from a Tango <em>Exception</em>?</h3>
<h2>A.</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include&lt;cutango-world.h&gt;</span></div><div class="line"><span class="keywordflow">try</span> {</div><div class="line">    <span class="comment">// ...</span></div><div class="line">}</div><div class="line"><span class="keywordflow">catch</span>(Tango::DevFailed &amp;e)</div><div class="line">{</div><div class="line">    CuTangoWorld tw;</div><div class="line">    std::string serr = tw.strerror(e);</div><div class="line">}</div></div><!-- fragment --><p><a class="anchor" id="migrate_log"></a> </p><h3>How to migrate from QTango <em>TUtil::instance()-&gt;addLog()</em> to <em>cumbia</em> log dialog?</h3>
<h2>A.</h2>
<p>QTango:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include&lt;TLog&gt;</span></div><div class="line"><span class="preprocessor">#include&lt;TUtil&gt;</span></div><div class="line"><span class="comment">// ...</span></div><div class="line">} <span class="keywordflow">catch</span> (Tango::DevFailed &amp;e) {</div><div class="line">    TLog log(e);</div><div class="line">    TUtil::instance()-&gt;addLog(log);</div><div class="line">}</div></div><!-- fragment --><p>cumbia</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;qulogimpl.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;cumbiatango.h&gt;</span></div><div class="line"><span class="comment">// ...</span></div><div class="line"></div><div class="line"><span class="comment">// 1. header file: class definition</span></div><div class="line"><span class="keyword">class </span>MyClass : <span class="keyword">public</span> QWidget</div><div class="line">{</div><div class="line">    Q_OBJECT</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">//...</span></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    CumbiaTango *cumbia_t;</div><div class="line">    QuLogImpl m_log_impl;  <span class="comment">// cumbia-qtcontrols log implementation</span></div><div class="line">    CuLog *m_log;          <span class="comment">// cumbia service, implements CuServiceI (cumbia/src/lib/services)</span></div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// 2. cpp file</span></div><div class="line"><span class="preprocessor">#include &lt;cutango-world.h&gt;</span></div><div class="line"></div><div class="line">MyClass::MyClass(...) {</div><div class="line">    <span class="comment">// cumbia_t = ...</span></div><div class="line">    m_log = <span class="keyword">new</span> CuLog(&amp;m_log_impl);</div><div class="line">    cumbia_t-&gt;getServiceProvider()-&gt;registerService(CuServices::Log, m_log);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// manage exception and add message to log</span></div><div class="line"><span class="comment">//</span></div><div class="line">} <span class="keywordflow">catch</span> (Tango::DevFailed &amp;e) {</div><div class="line">    CuTangoWorld tw;</div><div class="line">    std::string err = tw.strerror(e);</div><div class="line">    m_log-&gt;write(<span class="stringliteral">&quot;Dual&quot;</span>, err);</div><div class="line">    m_log_impl.getDialog()-&gt;show(); <span class="comment">// to show the dialog</span></div><div class="line">}</div></div><!-- fragment --><p>Please note that if you either migrate from a QTango project (<em>cumbia import [fast]</em>) or generate a new cumbia project (<em>cumbia new project</em>), most of the code needed to manage log messages is already written for you. The reason why more code is needed to <em>initialize</em> the log system is that cumbia does not resort to <em>singleton patterns</em> and the log model is more flexible: alternative implementations can be provided.</p>
<h2>Q.</h2>
<p><a class="anchor" id="ui_h_errors"></a> </p><h3>After converting a QTango project to a cumbia project, I get errors on the ui/ui_filexxx.h concerning properties of widgets that I know are defined in the cumbia widget version as well, e.g. <em>tLabel-&gt;setFalseString(..)</em></h3>
<h2>A.</h2>
<p>Open the <em>ui</em> file with the Qt designer and save it again, overwriting it. Then try rebuilding.</p>
<h2>Q.</h2>
<p><a class="anchor" id="migrate_config_state_color"></a> </p><h3>How to migrate QTango <em>Config::instance()-&gt;setStateColor</em> (and <em>setStateString</em>) to cumbia?</h3>
<h2>A.</h2>
<p>Open the <em>ui</em> file with the Qt designer and save it again, overwriting it. Then try rebuilding.</p>
<h2>Q.</h2>
<p><a class="anchor" id="multiengine"></a> </p><h3>How to support multiple engines (e.g. Tango and Epics) in the same application?</h3>
<h2>A.</h2>
<p>The application will make use of the <a href="../../cumbia/html/classCumbiaPool.html">CumbiaPool</a> class, in combination with CuControlsFactoryPool. Refer to the <a href="../../cumbia/html/classCumbiaPool.html">CumbiaPool</a> documentation, that provides an example. If the <em>cumbia pool</em> is configured with appropriate <em>source patterns</em>, the application should recognise the engine each source belongs to. For example, if the <em>patterns</em> for a Tango source are *".+/.+"* and *".+-&gt;.+"* (as <em>regular expressions</em>) and the <em>patterns</em> for an EPICS source include *".+:.+"*, then a source like <em>sys/tg_test/1/double_scalar</em> will be interpreted as a Tango source, while <em>motor:ai1</em> will be linked to the EPICS engine. The <a href="../../cumbia-tango/html/classCuTangoWorld.html">CuTangoWorld</a> and <a href="../../cumbia-epics/html/classCuEpicsWorld.html">CuEpicsWorld</a> provide lists of <em>default source patterns</em>. Please note that the "epics" and "tango" strings passed to registerCumbiaImpl, registerImpl and setSrcPatterns must match for each engine respectively. Those names link together the associated engines.</p>
<p>The <em>cumbia new project</em> tool will let you automatically create a skeleton project able to manage multiple engines.</p>
<p>A cumbia application with multiple engine support will generally contain the following initialization code:</p>
<div class="fragment"><div class="line">QumbiaClient::QumbiaClient(CumbiaPool *cumbia_pool, QWidget *parent) :</div><div class="line">    QWidget(parent),</div><div class="line">    <span class="comment">// ...</span></div><div class="line">{</div><div class="line">    <span class="comment">// ...</span></div><div class="line"></div><div class="line">    <span class="comment">// setup Cumbia pool and register cumbia implementations for tango and epics</span></div><div class="line"><span class="preprocessor">#ifdef QUMBIA_EPICS_CONTROLS</span></div><div class="line">    CumbiaEpics* cuep = <span class="keyword">new</span> CumbiaEpics(<span class="keyword">new</span> CuThreadFactoryImpl(), <span class="keyword">new</span> QThreadsEventBridgeFactory());</div><div class="line">    cu_pool-&gt;registerCumbiaImpl(<span class="stringliteral">&quot;epics&quot;</span>, cuep);</div><div class="line">    <span class="comment">// m_ctrl_factory_pool  is in this example a private member of type CuControlsFactoryPool</span></div><div class="line">    m_ctrl_factory_pool.registerImpl(<span class="stringliteral">&quot;epics&quot;</span>, CuEpReaderFactory());   <span class="comment">// register EPICS reader implementation</span></div><div class="line">    m_ctrl_factory_pool.registerImpl(<span class="stringliteral">&quot;epics&quot;</span>, CuEpWriterFactory());   <span class="comment">// register EPICS writer implementation</span></div><div class="line"></div><div class="line">    CuEpicsWorld ew;  <span class="comment">// EPICS cumbia helper class</span></div><div class="line">    m_ctrl_factory_pool.setSrcPatterns(<span class="stringliteral">&quot;epics&quot;</span>, ew.srcPatterns());</div><div class="line">    cumbia_pool-&gt;setSrcPatterns(<span class="stringliteral">&quot;epics&quot;</span>, ew.srcPatterns());</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef QUMBIA_TANGO_CONTROLS</span></div><div class="line">    CumbiaTango* cuta = <span class="keyword">new</span> CumbiaTango(<span class="keyword">new</span> CuThreadFactoryImpl(), <span class="keyword">new</span> QThreadsEventBridgeFactory());</div><div class="line">    cumbia_pool-&gt;registerCumbiaImpl(<span class="stringliteral">&quot;tango&quot;</span>, cuta);</div><div class="line">    m_ctrl_factory_pool.registerImpl(<span class="stringliteral">&quot;tango&quot;</span>, <a class="code" href="classCuTWriterFactory.html">CuTWriterFactory</a>());  <span class="comment">// register Tango writer implementation</span></div><div class="line">    m_ctrl_factory_pool.registerImpl(<span class="stringliteral">&quot;tango&quot;</span>, <a class="code" href="classCuTReaderFactory.html">CuTReaderFactory</a>());  <span class="comment">// register Tango reader implementation</span></div><div class="line"></div><div class="line">    CuTangoWorld tw;   <span class="comment">// Tango cumbia helper class</span></div><div class="line">    m_ctrl_factory_pool.setSrcPatterns(<span class="stringliteral">&quot;tango&quot;</span>, tw.srcPatterns());</div><div class="line">    cu_pool-&gt;setSrcPatterns(<span class="stringliteral">&quot;tango&quot;</span>, tw.srcPatterns());</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">    <span class="comment">// ...</span></div><div class="line">}</div></div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jun 21 2019 10:39:56 for qumbia-tango-controls by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
