<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cuuimake: cuuimake</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">cuuimake<span id="projectnumber">&#160;1.x</span>
   </div>
   <div id="projectbrief">Qt widgets on top of the cumbia C++ library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">cuuimake </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_src_cuuimake"></a> </p><h2>cumbia ui make. A tool to configure a Qt project with cumbia widgets</h2>
<p ><b>cuuimake</b> is a command line tool that can be found and built under the qumbia-apps/cuuimake/ folder.</p>
<h2>Installation</h2>
<ul>
<li>git clone <a href="https://github.com/ELETTRA-SincrotroneTrieste/cumbia-libs.git">https://github.com/ELETTRA-SincrotroneTrieste/cumbia-libs.git</a> </li>
<li>cd cumbia-apps/cuuimake/ </li>
<li>qmake </li>
<li>make </li>
<li>make install</li>
</ul>
<p>The final command will install cuuimake under <em>/usr/local/bin/</em> </p>
<p >An xml configuration file describing predefined options and keywords is installed under <em>/usr/local/share/cuuimake/cuuimake-cumbia-qtcontrols</em>.xml This file contains</p>
<ul>
<li>file name filters to find C++ sources (default: *.cpp, *.h, *.ui, ui_*.h) </li>
<li>the name of the available factories (for cumbiapool, cumbiatango and cumbiaepics) and the associated </li>
<li>the name of the classes that must be configured with cumbia. Constructor invocation must be extended with additional parameters.</li>
</ul>
<h2>cuuimake command shortcut</h2>
<p >If the cumbia utilities have been installed from the top level directory <em>qumbia-apps</em>, then <em>cuuimake</em> can also be executed with the following <em>shortcut</em></p>
<div class="fragment"><div class="line">cumbia ui make [arguments]</div>
</div><!-- fragment --><h2>cuuimake stages</h2>
<p >cuuimake task is accomplished in several stages:</p>
<ul>
<li><b>Clean</b> [optional] make clean is run first and ui_.*.h files are removed, so that they are regenerated and re-expanded. </li>
<li><b>Qmake</b> [optional] if the option is enabled [&ndash;qmake] qmake is run as a first step </li>
<li><b>Analysis</b> of the files in the project directory to find cumbia object declarations </li>
<li><b><a class="el" href="classExpand.html">Expand</a></b> the files are <em>expanded</em> so that the cumbia objects constructor is appropriately invoked with additional parameters </li>
<li><b>Uic</b> <em>Qt uic</em> is executed on the <em>ui</em> to generate the <em>ui_xxx.h</em> file. </li>
<li><b>Make</b> the make program is run to compile the application [option: &ndash;make]</li>
</ul>
<p>Other cuuimake modes:</p>
<ul>
<li><b>Help</b> the program has been invoked with the &ndash;help option </li>
<li><b>Info</b> the program is printing informative content</li>
</ul>
<h2>Personalize cuuimake</h2>
<p >Running <em>cuuimake</em> with the <em>&ndash;configure</em> option allows to store some settings permanently in your home directory by means of the Qt QSettings system:</p>
<div class="image">
<img src="cuuimake-configure.png" alt=""/>
<div class="caption">
cuuimake --configure</div></div>
 <p >Reply only with "y" or "n" to the <em>y|n</em> questions (without enter) and with a <em>digit + enter</em> to the <em>-jN</em> option.</p>
<p ><em>cuuimake &ndash;show-config</em> shows the current configuration</p>
<div class="image">
<img src="cuuimake-show-config1.png" alt=""/>
<div class="caption">
cuuimake --show-config</div></div>
 <p ><em>cuuimake &ndash;show-config</em> with additional parameters shows the options that <em>would be applied if</em> those options were given:</p>
<div class="image">
<img src="cuuimake-show-config2.png" alt=""/>
<div class="caption">
cuuimake --show-config</div></div>
 <h2>Using cuuimake</h2>
<h3>qmake</h3>
<p >Qt qmake must be run before anything else.</p>
<p ><b>Note:</b> <em>cuuimake &ndash;qmake</em> will run <em>cuuimake</em> including qmake as the first stage. <em>&ndash;qmake</em> option can be permanently enabled through the <em>cuuimake &ndash;configure</em> wizard.</p>
<p >After qmake, <em>cuuimake</em> must be run from the project top level directory. Alternatively, run <em>cuuimake &ndash;qmake</em> or enable qmake option with <em>cuuimake &ndash;configure</em>.</p>
<h3>cuuimake</h3>
<p >run <em>cuuimake</em> after qmake has been successfully executed, from the same (top level) directory where qmake has successfully completed.</p>
<p >This stage loads settings from <em>cuuimake</em> configuration files to know what are the classes that need to be expanded, finds the usage of those classes within the source files and expands them according to either CumbiaTango, CumbiaEpics or CumbiaPool is used. <em>Projects with mixed usage of CumbiaTango, CumbiaEpics or CumbiaPool are not supported</em> by <em>cuuimake</em>. If <em>cumbiaappwizard</em> application has been used to generate the app skeleton, the project will be easily analyzed and expanded by cuuimake.</p>
<div class="image">
<img src="cuuimake.png" alt=""/>
<div class="caption">
cuuimake</div></div>
 <p >As you can see in the last <em>analysis</em> line, the detected mode is <em>cumbiatango</em> and so the expansion involves adding CuTReaderFactory, CuTWriterFactory and CumbiaTango keywords and variable names to the source files. While the user interface file (<em></em>.ui ) does not change or is not removed, cuuimake will not process the source files again.</p>
<h3>cuuimake with <em>Qt designer "promoted widgets"</em></h3>
<p >As shown in the picture below, with Qt designer you can promote a base widget to a custom widget. If the promoted element is a cumbia widget, <em>cuuimake</em> must expand its constructor as well.</p>
<div class="image">
<img src="promote1.png" alt=""/>
<div class="caption">
Qt designer: promoting a widget</div></div>
 <p >The promoted class name is MyAttributeHistoryTree, which is not part of the library, is defined in the myattributehistory.h header and implemented in the myattributehistory.cpp file. If a promoted widget is detected by <em>cuuimake</em> in the <em>ui</em> file, its definition is searched among the files in the project. If the definition is found and recognised as a <em>cumbia</em> object, <em>cuuimake</em> is able to perform the necessary constructor expansion.</p>
<p >If <em>cuuimake</em> is unable to automatically expand the custom class, a build error will occur. To explicitly tell <em>cuuimake</em> that a widget needs to be expanded, you must create a file <em>cuuimake-historytree.conf</em>.</p>
<p ><b>cuuimake will use all files with a name matching the pattern "cuuimake[.*].conf to apply additional 
expansion to the classes therein listed&lt;/strong&gt;.

Edit the &lt;em&gt;cuuimake-historytree.conf&lt;/em&gt; text file and add the following line:

@code 
MyAttributeHistoryTree,cumbiatango,CumbiaTango *,CuTReaderFactory
\endcode

Comment lines are allowed and start with a '#'. Comma separated fields:

 -# class name, MyAttributeHistoryTree
 -# "engine", or "factory" one of: &lt;em&gt;cumbiatango&lt;/em&gt;, &lt;em&gt;cumbiaepics&lt;/em&gt;, &lt;em&gt;cumbiapool&lt;/em&gt;
 -# list of &lt;strong&gt;qualified&lt;/strong&gt; parameter type names that have to be inserted into the cumbia-qtcontrols object constructor
 (*&lt;strong&gt;qualified&lt;/strong&gt; class names*, as defined in the main class header file, if the project has been generated with &lt;em&gt;qumbiaappwizard&lt;/em&gt;)

For example, if &lt;em&gt;qumbiaappwizard&lt;/em&gt; creates a mycumbiatangoapp.h file and a class Mycumbiatangoapp that defines cumbia related attributes like this:

@code 
private:
    CumbiaTango *cu_t;
    CuTReaderFactory cu_tango_r_fac;
    CuTWriterFactory cu_tango_w_fac;

\endcode

and the custom widget has constructors defined as follows:

@code 

    MyAttributeHistoryTree(QWidget *_parent,  Cumbia *cumbia, const CuControlsReaderFactoryI &amp;r_fac);
    MyAttributeHistoryTree(QWidget *parent, CumbiaPool* cu_poo, const CuControlsFactoryPool&amp; f_poo);

\endcode

the &lt;em&gt;Qt designer&lt;/em&gt; would instantiate MyAttributeHistoryTree like this:

@code 
    widget = new MyAttributeHistoryTree(Mycumbiatangoapp);
\endcode

within the &lt;em&gt;src/ui_mycumbiatangoapp.h&lt;/em&gt; file, which would result in an error.

The line in the file &lt;em&gt;cuuimake-historytree.conf&lt;/em&gt;, placed at the top level project directory, alongside the .pro file, tells the &lt;em&gt;cuuimake&lt;/em&gt; to &lt;em&gt;expand&lt;/em&gt; the MyAttributeHistoryTree constructor
inserting the &lt;em&gt;cu_t, cu_tango_r_fac and cu_tango_w_fac parameters after *Mycumbiatangoapp&lt;/em&gt; (the parent widget):

@code 
//         widget = new MyAttributeHistoryTree(Mycumbiatangoapp); // expanded by cuuimake v.0.1
widget = new MyAttributeHistoryTree(Mycumbiatangoapp, cu_t, cu_tango_r_fac);
\endcode

If &lt;em&gt;qumbiaappwizard&lt;/em&gt; is used to create an &lt;em&gt;epics&lt;/em&gt; project, the main class header file contain something like this:

@code 
private:
    Ui::Cuepexample *ui;

    CumbiaEpics *cu_e;
    CuEpReaderFactory cu_ep_r_fac;
    CuEpWriterFactory cu_ep_w_fac;
\endcode

and if we promoted a QWidget to a &lt;em&gt;MyAttributeHistoryTree&lt;/em&gt;, the lines of the needed &lt;em&gt;cuuimake-historytree.conf&lt;/em&gt; file would have to be like this:

@code 
MyAttributeHistoryTree,cumbiaepics,CumbiaEpics *,CuEpReaderFactory
\endcode

&lt;h3&gt;cuuimake and make&lt;/h3&gt;

It is possible to run &lt;em&gt;cuuimake&lt;/em&gt; immediately followed by &lt;em&gt;make&lt;/em&gt; choosing one of these options:

\li running &lt;em&gt;cuuimake &amp;ndash;make&lt;/em&gt; 
\li configuring &lt;em&gt;cuuimake&lt;/em&gt; with &lt;em&gt;cuuimake &amp;ndash;configure&lt;/em&gt; and answering &lt;em&gt;y&lt;/em&gt; to the "make" question
\li running &lt;em&gt;cuuimake -jN&lt;/em&gt;, where N is the &lt;em&gt;make -j&lt;/em&gt; option for pipelined compilation.


&lt;h3&gt;Cleaning ui_.*.h files&lt;/h3&gt;

&lt;em&gt;cuuimake &amp;ndash;clean&lt;/em&gt;  runs &lt;em&gt;make clean&lt;/em&gt; and removes all ui_.*.h files under the &lt;em&gt;ui&lt;/em&gt; directory. (defined in the &lt;em&gt;cuuimake-cumbia-qtcontrols.xml&lt;/em&gt; global configuration file 
under *&lt;srcdirs&gt;&lt;uihdir&gt;*, "ui" by default). This is useful if you want the ui_.*.h files produced by Qt <em>uic</em> to be regenerated and re-expanded. For example, if you modify the <b>cuuimake.*.conf</b> file, you need to run <em>cuuimake &ndash;clean</em> to have the ui_.*.h files refreshed.</b></p>
<p ><b>To remove the <cite>ui_*.h</cite> files and proceed with the following stages, run <em>cuuimake</em> with the <em>&ndash;pre-clean</em> option instead. </b></p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 17 2022 11:59:54 for cuuimake by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
