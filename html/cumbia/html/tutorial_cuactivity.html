<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cumbia: Writing a simple activity</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">cumbia
   &#160;<span id="projectnumber">1.x</span>
   </div>
   <div id="projectbrief">general purpose multi threaded library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('tutorial_cuactivity.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Writing a simple activity </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this tutorial, we will learn how to write an activity that executes some work in the background and delivers the result to the main thread (the graphical user interface's thread). The code can be found under the <em>cumbia-qtcontrols/examples/simple_activity</em> directory of the cumbia-qtcontrols library sources. We chose to write a Qt application to make things easier, since Qt QApplication provides its own <em>event loop</em> where events from the cumbia activities are posted and processed. To use the QApplication <em>event loop</em>, cumbia needs a class that is available in that module. In fact, the cumbia <em>base</em> library does not depend on Qt and does not know anything about Qt <em>event loop</em>. For this reason, the example resides under the cumbia-qtcontrols module, even though it is thought to guide the reader through the learning of the <em>cumbia base</em> module only.</p>
<p>We can create and edit the project with <em>qtcreator</em>. In the example, the project needs to be linked with the cumbia libraries and the include path must contain cumbia headers. Since the project needs a cumbia-qtcontrols class to interact with the QApplication <em>event loop</em>, just include the <em>cumbia-qtcontrols.pri project include</em> file made available by the <em>cumbia-qtcontrols</em> library installation.</p>
<div class="fragment"><div class="line">include(/usr/local/include/cumbia-qtcontrols/cumbia-qtcontrols.pri)</div></div><!-- fragment --><p>If the project is generated with <em>qtcreator</em>, the .pro file will look like this, after we add the <em>include</em> directive at the top</p>
<div class="fragment"><div class="line">include(/usr/local/include/cumbia-qtcontrols/cumbia-qtcontrols.pri)</div><div class="line"></div><div class="line">TEMPLATE = app</div><div class="line">CONFIG += c++11</div><div class="line">CONFIG -= app_bundle</div><div class="line">CONFIG += qt</div><div class="line"></div><div class="line">SOURCES += main.cpp \</div><div class="line">    activity.cpp \</div><div class="line">    simplea.cpp</div><div class="line"></div><div class="line">HEADERS += \</div><div class="line">    activity.h \</div><div class="line">    simplea.h</div></div><!-- fragment --><p>Two classes have been added in the activity.h (.cpp) and simplea.h (.cpp):</p>
<ul>
<li>Activity (activity.h) implements <a class="el" href="classCuIsolatedActivity.html" title="A convenient CuActivity designed to be executed only once.">CuIsolatedActivity</a> (an activity which <em>execute</em> method is run only once) </li>
<li>SimpleA (simplea.h) is a Qt widget that will show a progress bar, a QTreeWidget and a push button.</li>
</ul>
<p>The Activity will simply produce some text messages in the background and deliver them to the widget, sleeping a while between the messages.</p>
<p>This is the skeleton of the Activity class:</p>
<div class="fragment"><div class="line">#include &lt;cuactivity.h&gt;</div><div class="line"></div><div class="line">class Activity : public CuIsolatedActivity</div><div class="line">{</div><div class="line">public:</div><div class="line">    Activity();</div><div class="line">};</div></div><!-- fragment --><p>Right click on the class name, choose <em>refactor</em> and then <em>insert virtual functions of base classes</em>. In the dialog box, select <em>insert definitions in implementation file</em> at the bottom. Your activity.h file will look like this now:</p>
<div class="fragment"><div class="line">#include &lt;cuisolatedactivity.h&gt;</div><div class="line"></div><div class="line">class Activity : public CuIsolatedActivity</div><div class="line">{</div><div class="line">public:</div><div class="line">    Activity();</div><div class="line">    </div><div class="line">    // CuActivity interface</div><div class="line">public:</div><div class="line">    int getType() const;</div><div class="line">    void event(CuActivityEvent *e);</div><div class="line">    bool matches(const CuData &amp;token) const;</div><div class="line">    int repeat() const;</div><div class="line">    </div><div class="line">protected:</div><div class="line">    void init();</div><div class="line">    void execute();</div><div class="line">    void onExit();</div><div class="line">};</div></div><!-- fragment --><dl class="section user"><dt>The class constructor</dt><dd>We will use CuIsolatedActivity::CuIsolatedActivity(const CuData&amp; token) class constructor for the base class. The token is a <a class="el" href="classCuData.html" title="container for data exchange for the cumbia library and its clients">CuData</a> bundle that contains some key/value pairs describing the activity. We will see hot to deal with it when we instantiate the activity. As described in the <a class="el" href="classCuIsolatedActivity.html#adf912e98048533e137e21cc7dc0d2f3e" title="class constructor. Takes optional arguments and sets up the isolated activity">CuIsolatedActivity::CuIsolatedActivity</a> class constructor documentation, the following activity flags are enabled by default:</dd></dl>
<ul>
<li><a class="el" href="classCuActivity.html#a23c71d30d18fdf76bf7b3b0ce148013da8a338bec3440e4704d70e4aad970b0cf">CuActivity::CuADeleteOnExit</a> </li>
<li><a class="el" href="classCuActivity.html#a23c71d30d18fdf76bf7b3b0ce148013da50f1c2188f6b6e937f43c5f5e728f126">CuActivity::CuAUnregisterAfterExec</a></li>
</ul>
<p>They are ok for this example, because cumbia will automatically unregiter and dispose the Activity when the job is over.</p>
<dl class="section user"><dt>Implementing the CuActivity interface</dt><dd></dd></dl>
<p>Let's discuss how to implement the <a class="el" href="classCuActivity.html" title="a class with hook functions where work can be done in a separate thread and wherefrom results are pub...">CuActivity</a> interface</p>
<ul>
<li>getType will return <a class="el" href="classCuActivity.html#a8d1ec3c656fa9d8b8b320741b2182514a652076b71e3d83b25b967bd37e4592cc">CuActivity::Isolated</a>, because the activity executes only once. </li>
<li>we will leave the event method empty in this simple example </li>
<li>matches will return true if the token matches <em>this activity</em> token</li>
</ul>
<div class="fragment"><div class="line">Activity::Activity(const CuData&amp; token)</div><div class="line">    : CuIsolatedActivity(token) {</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line">int Activity::getType() const {</div><div class="line">    return CuActivity::Isolated;</div><div class="line">}</div><div class="line"></div><div class="line">void Activity::event(CuActivityEvent *) {</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line">bool Activity::matches(const CuData &amp;token) const {</div><div class="line">    return getToken() == token;</div><div class="line">}</div></div><!-- fragment --><dl class="section user"><dt>CuActivity hooks: init, execute, onExit</dt><dd></dd></dl>
<p>Do now implement the three most important methods where the work is carried out by the activity. <em>init, execute</em> and <em>onExit</em> are run in a separate thread. We don't have to worry about that, and we can forgive about locking and variable synchronization too. In this simple application, the methods will produce some messages that the graphical interface will show. Each message contains the value of the pointer to the current thread (as returned by pthread_self() ), so that it will be clear from which thread the code is run.</p>
<p>The <em>init</em> and <em>onExit</em> will prepare and deliver a text message with the name of the method and the address of the <em>current thread</em>:</p>
<div class="fragment"><div class="line">void Activity::init()</div><div class="line">{</div><div class="line">    // result: a CuData.</div><div class="line">    // pick the token to initialise the result</div><div class="line">    CuData d = getToken();</div><div class="line">    d[&quot;msg&quot;] = std::string(&quot;init&quot;); // insert the message into the result</div><div class="line">    d[&quot;thread&quot;] = write_thread_t();</div><div class="line">    publishResult(d); // post to main thread</div><div class="line">}</div><div class="line"></div><div class="line">void Activity::onExit()</div><div class="line">{</div><div class="line">    // do exactly the same as init</div><div class="line">    CuData d = getToken();</div><div class="line">    d[&quot;msg&quot;] = std::string(&quot;onExit&quot;);</div><div class="line">    d[&quot;thread&quot;] = write_thread_t();</div><div class="line">    publishResult(d);</div><div class="line">}</div></div><!-- fragment --><p>The <em>execute</em> method will do its work in three stages. It will publish the progress each time. The function will sleep for two seconds between each stage.</p>
<div class="fragment"><div class="line">void Activity::execute()</div><div class="line">{</div><div class="line">    CuData d = getToken();</div><div class="line">    for(int i = 1; i &lt;= 3; i++) {</div><div class="line">        d[&quot;msg&quot;] = std::string(&quot;execute [&quot;) + std::to_string(i) + std::string(&quot;]&quot;);</div><div class="line">        d[&quot;thread&quot;] = write_thread_t();</div><div class="line">        publishProgress(i, 3, d);</div><div class="line">        if (i &lt; 3) sleep(2);</div><div class="line">    }</div><div class="line">    d[&quot;thread&quot;] = write_thread_t();</div><div class="line">    d[&quot;msg&quot;] = std::string(&quot;execute [done]&quot;);</div><div class="line">    publishResult(d);</div><div class="line">}</div></div><!-- fragment --><dl class="section user"><dt>The graphical user interface</dt><dd></dd></dl>
<p>Let's add a QProgressBar, a QTreeWidget and a QCheckBox to the graphical user interface. The tree widget will display all messages as soon as they are delivered. A "start" QPushButton will launch the activity on demand. A <em>start</em> Qt <em>slot</em> will be connected to the QPushButton <em>clicked</em> signal. It will reset the progress bar and launch the activity. The <em>checkbox</em>, if checked, will tell <em>cumbia</em> to run the activity in the same thread, if unchecked, each activity is run in a separate thread. If you click the <em>start</em> button before an activity is completed, you will notice the different behavior of the application.</p>
<p>Open the simplea.cpp and create the widgets as shown below. Use a vertical box layout to place the widgets in two rows.</p>
<div class="fragment"><div class="line">#include &quot;simplea.h&quot;</div><div class="line">#include &lt;QProgressBar&gt;</div><div class="line">#include &lt;QTreeWidget&gt; // display events in a list </div><div class="line">#include &lt;QTreeWidgetItem&gt; // to populate the tree widget with items</div><div class="line">#include &lt;QVBoxLayout&gt;</div><div class="line">#include &lt;QPushButton&gt;</div><div class="line">#include &lt;QCheckBox&gt;</div><div class="line">#include &lt;QHeaderView&gt;</div><div class="line"></div><div class="line">SimpleA::SimpleA(QWidget *parent) : QWidget(parent)</div><div class="line">{</div><div class="line">   QVBoxLayout *vlo = new QVBoxLayout(this); // layout in two rows</div><div class="line">    QProgressBar *pb = new QProgressBar(this); // progress bar</div><div class="line">    pb-&gt;setMinimum(0); pb-&gt;setMaximum(3); pb-&gt;setValue(0);</div><div class="line">    vlo-&gt;addWidget(pb);</div><div class="line">    QTreeWidget *tw = new QTreeWidget(this);</div><div class="line">    tw-&gt;setHeaderLabels(QStringList() &lt;&lt; &quot;activity&quot; &lt;&lt; &quot;message&quot; &lt;&lt; &quot;activity thread&quot; &lt;&lt; &quot;main thread&quot;);</div><div class="line">    tw-&gt;header()-&gt;setSectionResizeMode(QHeaderView::ResizeToContents);</div><div class="line">    vlo-&gt;addWidget(tw);</div><div class="line">    QPushButton *pbu = new QPushButton(&quot;start&quot;, this);</div><div class="line">    connect(pbu, SIGNAL(clicked()), this, SLOT(start()));</div><div class="line">    vlo-&gt;addWidget(pbu);</div><div class="line">    QPushButton *pbclear = new QPushButton(&quot;clear&quot;, this);</div><div class="line">    connect(pbclear, SIGNAL(clicked()), tw, SLOT(clear()));</div><div class="line">    vlo-&gt;addWidget(pbclear);</div><div class="line">    QCheckBox *cb = new QCheckBox(&quot;same thread&quot;, this);</div><div class="line">    cb-&gt;setObjectName(&quot;cbSameTh&quot;);</div><div class="line">    cb-&gt;setToolTip(&quot;if this is checked and \&quot;start\&quot; is clicked while another activity\n&quot;</div><div class="line">                   &quot;is running, the next activity is started in the same thread as the\n&quot;</div><div class="line">                   &quot;running one. Otherwise, another thread is started&quot;);</div><div class="line">    cb-&gt;setChecked(true);</div><div class="line">    vlo-&gt;addWidget(cb);</div><div class="line">    resize(500, 400);</div><div class="line">}</div><div class="line"></div><div class="line">void SimpleA::start()</div><div class="line">{</div><div class="line">    findChild&lt;QProgressBar *&gt;()-&gt;setValue(0);</div><div class="line">}</div></div><!-- fragment --><p>In the simplea.h header file declare the <em>start</em> slot as <em>private</em>.</p>
<div class="fragment"><div class="line">#include &lt;QWidget&gt;</div><div class="line"></div><div class="line">class SimpleA : public QWidget</div><div class="line">{</div><div class="line">    Q_OBJECT</div><div class="line">public:</div><div class="line">    explicit SimpleA(QWidget *parent = nullptr);</div><div class="line"></div><div class="line">private slots:</div><div class="line">    void start();</div><div class="line">};</div></div><!-- fragment --><p>In the <em>start</em> slot, an Activity is instantiated. It must be registered through the <a class="el" href="classCumbia.html#affe4f4e6912be2d453411d5efa8df1b7" title="registers (adds) an activity to cumbia, links it to a data listener, assigns its execution to an exis...">Cumbia::registerActivity</a> method, that takes a <em><a class="el" href="classCuThreadListener.html" title="interface for a listener that is notified when progress is done in the background and data is ready">CuThreadListener</a></em> amongst its arguments. The data from the worker thread is delivered through <a class="el" href="classCuThreadListener.html#a8195c9a446ac1dabb4cea737de770c4c" title="onResult delivers to the listener&#39;s thread the results of the work performed by the activity&#39;s backgr...">CuThreadListener::onResult</a> and <a class="el" href="classCuThreadListener.html#a4feb7802a8844232a2d9cea98f2554c7" title="onProgress notifies the listener&#39;s thread about the progress of the ongoing work in the activity&#39;s ba...">CuThreadListener::onProgress</a>. Moreover, another method from <a class="el" href="classCuThreadListener.html" title="interface for a listener that is notified when progress is done in the background and data is ready">CuThreadListener</a> must be implemented: <a class="el" href="classCuThreadListener.html#a5a825fb8fc7ffcdfe3b0dae1048419ac" title="getToken returns a token characterizing the listener">CuThreadListener::getToken</a>. The token returned by this call is a <a class="el" href="classCuData.html" title="container for data exchange for the cumbia library and its clients">CuData</a> bundle storing key/value pairs used to describe the listener.</p>
<p>Modify the code so that SimpleA implements the <a class="el" href="classCuThreadListener.html" title="interface for a listener that is notified when progress is done in the background and data is ready">CuThreadListener</a> interface. Right click again on the class name in the header file and choose <em>refactor</em> and then <em>insert virtual functions of base classes</em>.</p>
<div class="fragment"><div class="line">#include &lt;cuthreadlistener.h&gt;</div><div class="line"></div><div class="line">class SimpleA : public QWidget, public CuThreadListener</div></div><!-- fragment --><p><em>qtcreator</em> will insert the method definitions and the epty bodies for the required methods to be implemented</p>
<p>As aforementioned, activities are registered through <a class="el" href="classCumbia.html#affe4f4e6912be2d453411d5efa8df1b7" title="registers (adds) an activity to cumbia, links it to a data listener, assigns its execution to an exis...">Cumbia::registerActivity</a>. Declare a <a class="el" href="classCumbia.html" title="primary cumbia class where activities are registered and unregistered. Provides access to the cumbia ...">Cumbia</a> attribute in the SimpleA class as a private member.</p>
<div class="fragment"><div class="line">    // CuThreadListener interface</div><div class="line">public:</div><div class="line">    void onProgress(int step, int total, const CuData &amp;data);</div><div class="line">    void onResult(const CuData &amp;data);</div><div class="line">    CuData getToken() const;</div><div class="line">    </div><div class="line">private:</div><div class="line">    Cumbia *m_cumbia;</div></div><!-- fragment --><p>Below the include directives at the top of the simplea.h file, add this:</p>
<div class="fragment"><div class="line">#include &lt;QWidget&gt;</div><div class="line">#include &lt;cuthreadlistener.h&gt;</div><div class="line"></div><div class="line">class Cumbia;</div><div class="line"></div><div class="line">class SimpleA : public QWidget, public CuThreadListener</div><div class="line">{</div><div class="line">    // ...</div></div><!-- fragment --><p>The include directive for cumbia will be added to the simplea.cpp file.</p>
<dl class="section user"><dt>CuThreadListener interface implementation in simplea.cpp</dt><dd></dd></dl>
<p>The <em>onProgress</em> and <em>onResult</em> methods in SimpleA class will insert into the view a three column QTreeWidgetItem displaying: </p><ul>
<li>the message from the <em>activity</em> running in background </li>
<li>the pointer to the worker thread </li>
<li>the pointer to the current thread (the graphical user interface thread, or <em>main thread</em>, as we use to say)</li>
</ul>
<div class="fragment"><div class="line">void SimpleA::onProgress(int step, int /* total */, const CuData &amp;data)</div><div class="line">{</div><div class="line">    QString thread, main_th;</div><div class="line">    thread.sprintf(&quot;0x%lx&quot;, data[&quot;thread&quot;].toULongInt());</div><div class="line">    main_th.sprintf(&quot;0x%lx&quot;, pthread_self());</div><div class="line">    findChild&lt;QProgressBar *&gt;()-&gt;setValue(step);</div><div class="line">    new QTreeWidgetItem(findChild&lt;QTreeWidget *&gt;(),</div><div class="line">                        QStringList() &lt;&lt; QString::fromStdString(data[&quot;msg&quot;].toString())</div><div class="line">            &lt;&lt; thread);</div><div class="line">}</div><div class="line"></div><div class="line">void SimpleA::onResult(const CuData &amp;data)</div><div class="line">{</div><div class="line">    QString thread, main_th;</div><div class="line">    thread.sprintf(&quot;0x%lx&quot;, data[&quot;thread&quot;].toULongInt());</div><div class="line">    main_th.sprintf(&quot;0x%lx&quot;, pthread_self());</div><div class="line">    QTreeWidgetItem *tw = new QTreeWidgetItem(findChild&lt;QTreeWidget *&gt;(),</div><div class="line">                        QStringList() &lt;&lt; QString::fromStdString(data[&quot;msg&quot;].toString())</div><div class="line">            &lt;&lt; thread);</div><div class="line">    tw-&gt;setBackgroundColor(0, QColor(Qt::green));</div><div class="line">}</div></div><!-- fragment --><p>The <em>getToken</em> method returns a descriptive <a class="el" href="classCuData.html" title="container for data exchange for the cumbia library and its clients">CuData</a> structure with the name of the activity:</p>
<div class="fragment"><div class="line">CuData SimpleA::getToken() const</div><div class="line">{</div><div class="line">    printf(&quot;SimpleA::getToken is called\n&quot;);</div><div class="line">    return CuData(&quot;activity&quot;, &quot;simple_activity&quot;);</div><div class="line">}</div></div><!-- fragment --><dl class="section user"><dt>Start the activity</dt><dd></dd></dl>
<p>Discuss now how to write the <em>start slot</em>. Every time the <em>start button</em> is clicked, a new activity is launched and a counter is used to name the activity. If the "*same thread*" check box is selected, every new activity is run in the same thread. This is accomplished by providing the same <em>thread token</em> to the <a class="el" href="classCumbia.html#affe4f4e6912be2d453411d5efa8df1b7" title="registers (adds) an activity to cumbia, links it to a data listener, assigns its execution to an exis...">Cumbia::registerActivity</a> call. If the check box is not checked, then the <em>thread token</em> for the new activity is different from the previous one. In fact, the function <a class="el" href="classCuThread.html#ad0b8cdef8f5a753a2498eb78da85a8ff" title="returns true if this thread token is equal to other_thread_token">CuThread::isEquivalent</a> returns true if the token the thread was created with is the same as the token assigned to the new activity. We use the "*th_id*" value to increment the thread token or to leave it the same as before in the <em>start</em> method.</p>
<p>The <a class="el" href="classCumbia.html#affe4f4e6912be2d453411d5efa8df1b7" title="registers (adds) an activity to cumbia, links it to a data listener, assigns its execution to an exis...">Cumbia::registerActivity</a> call requires the following parameters: </p><ul>
<li>a pointer to the new activity </li>
<li>a pointer to a <a class="el" href="classCuThreadListener.html" title="interface for a listener that is notified when progress is done in the background and data is ready">CuThreadListener</a>, which SimpleA is an implementation </li>
<li>a <em>thread token</em>, used to determine wether the activity is run in an already existing thread with the same <em>token</em> or in a new one, as discussed above </li>
<li>a <em>const reference to a <a class="el" href="classCuThreadFactoryImplI.html" title="an interface that requires the implementation of a method to create a thread">CuThreadFactoryImplI</a></em> interface </li>
<li>a <em>const reference to a <a class="el" href="classCuThreadsEventBridgeFactory__I.html" title="interface for a factory to create a bridge binding a thread to an event loop">CuThreadsEventBridgeFactory_I</a></em> interface</li>
</ul>
<p>The usage of the first three arguments is straightforward and has already been discussed.</p>
<p>The <em><a class="el" href="classCuThreadFactoryImplI.html" title="an interface that requires the implementation of a method to create a thread">CuThreadFactoryImplI</a></em> is an interface that defines how a thread for cumbia is created. For cumbia applications, <a class="el" href="classCuThread.html" title="cumbia thread implementation">CuThread</a> can be used, and the <a class="el" href="classCuThreadFactoryImpl.html" title="implementation of CuThreadFactoryImplI used to instantiate and return a new CuThread">CuThreadFactoryImpl</a> can be used to let cumbia instantiate a new <a class="el" href="classCuThread.html" title="cumbia thread implementation">CuThread</a> or reuse a running one according to the <em>token</em> provided</p>
<p>The <em><a class="el" href="classCuThreadsEventBridgeFactory__I.html" title="interface for a factory to create a bridge binding a thread to an event loop">CuThreadsEventBridgeFactory_I</a></em> is an interface to define how the threads event bridge for cumbia is created. Since the example is a Qt application, we adopt QThreadsEventBridgeFactory, that makes use of Qt QApplication event loop. This is the recommended choice for Qt applications.</p>
<p>The observations just made lead to the following lines of code:</p>
<div class="fragment"><div class="line">void SimpleA::start()</div><div class="line">{</div><div class="line">    m_cnt++;</div><div class="line">    CuData th_tok(&quot;name&quot;, &quot;simplea_thread&quot;); // thread token</div><div class="line">    if(!findChild&lt;QCheckBox *&gt;(&quot;cbSameTh&quot;)-&gt;isChecked())</div><div class="line">        m_thid = m_cnt; // change thread id so that a new thread is used for the activity</div><div class="line">    th_tok[&quot;th_id&quot;] = m_thid;</div><div class="line">    findChild&lt;QProgressBar *&gt;()-&gt;setValue(0);  // reset progress</div><div class="line">    Activity *a = new Activity(CuData(&quot;name&quot;, &quot;activity &quot; + std::to_string(m_cnt)));</div><div class="line">    m_cumbia-&gt;registerActivity(a, this, th_tok,</div><div class="line">                               CuThreadFactoryImpl(),</div><div class="line">                               QThreadsEventBridgeFactory());</div><div class="line">}</div></div><!-- fragment --><p>Finally, the code for the <em>main.cpp</em> file is shown. A QApplication is created and executed and the <em>SimpleA</em> main widget is instantiated and shown.</p>
<div class="fragment"><div class="line">#include &lt;QApplication&gt;</div><div class="line">#include &quot;simplea.h&quot;</div><div class="line"></div><div class="line">int main(int argc, char **argv)</div><div class="line">{</div><div class="line">    QApplication a(argc, argv );</div><div class="line">    a.setApplicationName(&quot;simple_activity&quot;);</div><div class="line">    SimpleA *w = new SimpleA(0);</div><div class="line">    w-&gt;show();</div><div class="line">    int ret = a.exec();</div><div class="line">    delete w;</div><div class="line">    return ret;</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Sep 10 2019 10:51:20 for cumbia by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
